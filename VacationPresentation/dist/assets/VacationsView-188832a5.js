import{P as V,S as B}from"./SearchbarItem-3a3ae394.js";import{V as O}from"./ViewRulesModal-c52cd747.js";import{_ as T,o as l,c as u,a as t,w as b,b as r,v as c,h as v,t as g,F as f,f as _,i as w,j as D,r as y,g as U}from"./index-8da96a42.js";const k={props:["vacation","toggle","units","vacId"],data(){return{selectedUnit:this.vacation.rule.unitID,newHire:[],hireObject:{numberOfDays:null,startYears:null,endYears:null},successMsg:"",errMsg:""}},created(){console.log(this.vacation)},methods:{submitForm(){console.log("update vacation is clicked"),this.successMsg="",this.errMsg="";for(var i=this.vacation.rule.startDate,e=this.vacation.rule.endDate,a=0;a<this.vacation.hires.length;a++)this.hireObject.numberOfDays=this.vacation.hires[a].numberOfDays,this.hireObject.startYears=this.vacation.hires[a].startYears,this.hireObject.endYears=this.vacation.hires[a].endYears,this.newHire.push({...this.hireObject});console.log(this.vacation.rule.startDate),console.log(this.vacation.rule.endDate),console.log(this.vacation.vacation.name),fetch("http://localhost:5242/api/vacation/"+this.vacId,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.$store.state.token}`},body:JSON.stringify({vacation:{name:this.vacation.vacation.name,description:this.vacation.vacation.description,isBasedOnHire:this.vacation.isBasedOnHire},hires:this.newHire,rule:{numberOfTimes:this.vacation.rule.numberOfTimes,duration:this.vacation.rule.duration,unitID:this.selectedUnit,startDate:i,endDate:e}})}).then(s=>s.json()).then(s=>{console.log(s),s.error!=null?this.errMsg=s.error:this.successMsg=s.message}).catch(s=>console.log(s.message))}}},I=t("h2",{class:"form-title"},"Update Vacation",-1),j={class:"container"},C={class:"update-vac-container"},H=t("label",null,"Name",-1),M={key:0},F=t("label",null,[D("Duration "),t("small",null,"in days")],-1),N=t("label",null,"Description",-1),R={class:"upd-vac-btn"},$=t("button",{type:"submit"},"Update",-1),x={class:"success-msg-cont"},S={class:"err-msg-cont5"},z={class:"update-rules-container"},Y={class:"update-hire-rules-container"},E=t("label",null,"Days",-1),P=["onUpdate:modelValue"],A=t("label",null,[D("From "),t("small",null,"in years")],-1),G=["onUpdate:modelValue"],L=t("label",null,[D("To "),t("small",null,"in years")],-1),J=["onUpdate:modelValue"],q={key:1,class:"rules-period-container"},K={class:"numtimes-div"},Q=t("label",null,"Number of times",-1),W={class:"period-div"},X=t("label",null,"From",-1),Z=t("label",null,"To",-1),tt={key:2,class:"rules-unit-container"},et={class:"numtimes-div"},st=t("label",null,"Number of times",-1),at={class:"unit-container"},nt=t("label",null,"Per",-1),ot=["value"];function it(i,e,a,s,o,m){return l(),u("div",{class:"modal-overlay",onClick:e[11]||(e[11]=n=>i.$emit("close-modal"))},[t("div",{class:"update-vac-modal",onClick:e[10]||(e[10]=b(()=>{},["stop"]))},[t("form",{onSubmit:e[9]||(e[9]=b((...n)=>m.submitForm&&m.submitForm(...n),["prevent"]))},[I,t("div",j,[t("div",C,[H,r(t("input",{type:"text",placeholder:"Name","onUpdate:modelValue":e[0]||(e[0]=n=>a.vacation.vacation.name=n)},null,512),[[c,a.vacation.vacation.name]]),a.vacation.isBasedOnHire==!1?(l(),u("div",M,[F,r(t("input",{type:"number",min:"1","onUpdate:modelValue":e[1]||(e[1]=n=>a.vacation.rule.duration=n)},null,512),[[c,a.vacation.rule.duration]])])):v("",!0),N,r(t("input",{type:"text",placeholder:"Description","onUpdate:modelValue":e[2]||(e[2]=n=>a.vacation.vacation.description=n)},null,512),[[c,a.vacation.vacation.description]]),t("div",R,[$,t("div",x,[t("h3",null,g(this.successMsg),1)]),t("div",S,[t("h3",null,g(this.errMsg),1)])])]),t("div",z,[t("div",Y,[a.toggle.toggleHire==!0?(l(!0),u(f,{key:0},_(this.vacation.hires,n=>(l(),u("div",{class:"hire-rules-container",key:n.hireID},[E,r(t("input",{type:"number",min:"1","onUpdate:modelValue":h=>n.numberOfDays=h},null,8,P),[[c,n.numberOfDays]]),A,r(t("input",{type:"number","onUpdate:modelValue":h=>n.startYears=h},null,8,G),[[c,n.startYears]]),L,r(t("input",{type:"number","onUpdate:modelValue":h=>n.endYears=h},null,8,J),[[c,n.endYears]])]))),128)):v("",!0),a.toggle.togglePeriod==!0?(l(),u("div",q,[t("div",K,[Q,r(t("input",{type:"number","onUpdate:modelValue":e[3]||(e[3]=n=>a.vacation.rule.numberOfTimes=n)},null,512),[[c,a.vacation.rule.numberOfTimes]])]),t("div",W,[X,r(t("input",{type:"date","onUpdate:modelValue":e[4]||(e[4]=n=>a.vacation.rule.startDate=n)},null,512),[[c,a.vacation.rule.startDate]]),Z,r(t("input",{type:"date","onUpdate:modelValue":e[5]||(e[5]=n=>a.vacation.rule.endDate=n)},null,512),[[c,a.vacation.rule.endDate]])])])):v("",!0),a.toggle.toggleUnit==!0?(l(),u("div",tt,[t("div",et,[st,r(t("input",{type:"number","onUpdate:modelValue":e[6]||(e[6]=n=>a.vacation.rule.numberOfTimes=n)},null,512),[[c,a.vacation.rule.numberOfTimes]])]),t("div",at,[nt,r(t("select",{"onUpdate:modelValue":e[7]||(e[7]=n=>this.selectedUnit=n)},[(l(!0),u(f,null,_(this.units,n=>(l(),u("option",{key:n.unitID,value:n.unitID},g(n.unitName),9,ot))),128))],512),[[w,this.selectedUnit]])])])):v("",!0)])])]),t("button",{class:"exit-btn",type:"button",onClick:e[8]||(e[8]=n=>i.$emit("close-modal")),id:"vac-exit-btn"},"Exit")],32)])])}const lt=T(k,[["render",it]]);const rt={components:{PaginationItem:V,SearchbarItem:B,ViewRulesModal:O,UpdateVacationItem:lt},data(){return{vacations:[],units:[],vacId:null,vacationToBeUpdated:{vacation:{name:null,description:null,isBasedOnHire:null},hires:[],rule:{numberOfTimes:null,duration:null,unitID:null,startDate:null,endDate:null}},toggleVacationRule:{toggleHire:!1,togglePeriod:!1,toggleUnit:!1},modalFlag1:!1,modalFlag2:!1,updateShow:!1,isBasedOnHire:!1,rule:{numberOfTimes:"",duration:"",unitID:"",unitName:"",startDate:"",endDate:""},hire:[]}},mounted(){const i={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.$store.state.token}`}};fetch("http://localhost:5242/api/vacation",i).then(e=>e.json()).then(e=>this.vacations=e).catch(e=>console.log(e.message))},methods:{async fetchData(i){const e={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.$store.state.token}`}};try{const s=await(await fetch("http://localhost:5242/api/rule/"+i,e)).json();console.log(s),this.rule.numberOfTimes=s.numberOfTimes,this.rule.duration=s.duration,this.rule.unitID=s.unitID,s.startDate!=null?this.rule.startDate=s.startDate.split("T")[0]:this.rule.startDate=null,s.endDate!=null?this.rule.endDate=s.endDate.split("T")[0]:this.rule.endDate=null,console.log(this.rule,"test")}catch(a){console.log(a.message)}if(this.rule.unitID!=null)try{const s=await(await fetch("http://localhost:5242/api/unit/"+this.rule.unitID,e)).json();console.log(s),this.rule.unitName=s.unitName}catch(a){console.log(a.message)}},handleView(i){this.modalFlag1=!0;for(var e=0;e<this.vacations.length;e++)this.vacations[e].vacationID===i&&(this.isBasedOnHire=this.vacations[e].isBasedOnHire);const a={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.$store.state.token}`}};this.isBasedOnHire?fetch("http://localhost:5242/api/hire/"+i,a).then(s=>{console.log(s.status),s.json()}).then(s=>{this.hire=s,console.log(this.hire)}).catch(s=>console.log(s.message)):this.fetchData(i)},async handleUpdate(i){var e=null;this.toggleVacationRule.toggleHire=!1,this.toggleVacationRule.togglePeriod=!1,this.toggleVacationRule.toggleUnit=!1,this.vacId=i;const a={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.$store.state.token}`}};console.log("update was clicked with vac id =",i);try{const s=await fetch("http://localhost:5242/api/vacation/"+i,a);if(console.log(s.status),s.status===401){console.log("action unauthorized, navigate to unauthorized page"),this.$router.push("/401");return}const o=await s.json();this.vacationToBeUpdated.vacation.name=o.name,this.vacationToBeUpdated.vacation.description=o.description,this.vacationToBeUpdated.isBasedOnHire=o.isBasedOnHire,e=o.isBasedOnHire}catch(s){console.log(s.message)}if(e==!0)fetch("http://localhost:5242/api/hire/"+i,a).then(s=>s.json()).then(s=>{this.vacationToBeUpdated.hires=s,console.log(this.vacationToBeUpdated.hires)}).catch(s=>console.log(s.message)),this.toggleVacationRule.toggleHire=!0;else if(e==!1){try{const o=await(await fetch("http://localhost:5242/api/rule/"+i,a)).json();this.vacationToBeUpdated.rule.numberOfTimes=o.numberOfTimes,this.vacationToBeUpdated.rule.duration=o.duration,this.vacationToBeUpdated.rule.unitID=o.unitID,o.startDate!=null?this.vacationToBeUpdated.rule.startDate=o.startDate.split("T")[0]:this.vacationToBeUpdated.rule.startDate=null,o.endDate!=null?this.vacationToBeUpdated.rule.endDate=o.endDate.split("T")[0]:this.vacationToBeUpdated.rule.endDate=null,o.unitID==null?this.toggleVacationRule.togglePeriod=!0:this.toggleVacationRule.toggleUnit=!0}catch(s){console.log(s.message)}if(this.toggleVacationRule.toggleUnit==!0)try{const o=await(await fetch("http://localhost:5242/api/unit",a)).json();this.units=o,console.log(o)}catch(s){console.log(s.message)}}this.updateShow=!0},handleDelete(i){console.log("deleting vacations with id: "+i),fetch("http://localhost:5242/api/vacation/"+i,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.$store.state.token}`}}).then(e=>{console.log(e.status),e.json(),e.status===401&&(console.log("action unauthorized, navigate to unauthorized page"),this.$router.push("/401"))}).then(e=>console.log(e)).catch(e=>console.log(e.message))}}},ut={class:"vacation-info"},ct=t("h2",{class:"form-title"},"View Vacations",-1),dt={class:"vacation-table"},ht=t("tr",null,[t("th",null,"Name"),t("th",null,"Description"),t("th",null,"Rules"),t("th"),t("th")],-1),mt={class:"view-btn-container"},vt=["onClick"],gt=["onClick"],pt=["onClick"],ft=t("div",{class:"trash-div"},null,-1),_t=[ft];function Dt(i,e,a,s,o,m){const n=y("ViewRulesModal"),h=y("UpdateVacationItem");return l(),u("div",ut,[ct,t("table",dt,[ht,(l(!0),u(f,null,_(o.vacations,d=>(l(),u("tr",{key:d.vacationID},[t("td",null,g(d.name),1),t("td",null,g(d.description),1),t("td",null,[t("div",mt,[t("button",{class:"view-btn",onClick:p=>m.handleView(d.vacationID),onCloseModal:e[0]||(e[0]=p=>o.modalFlag1=!1)}," View ",40,vt)])]),t("td",null,[t("button",{class:"update-btn",onClick:p=>m.handleUpdate(d.vacationID),onCloseModal:e[1]||(e[1]=p=>o.updateShow=!1)}," Update ",40,gt)]),t("td",{onClick:p=>m.handleDelete(d.vacationID)},_t,8,pt)]))),128))]),t("div",null,[o.modalFlag1?(l(),U(n,{key:0,onCloseModal:e[2]||(e[2]=d=>o.modalFlag1=!1),rule:o.rule,hire:o.hire,flag:o.isBasedOnHire},null,8,["rule","hire","flag"])):v("",!0)]),t("div",null,[o.updateShow?(l(),U(h,{key:0,onCloseModal:e[3]||(e[3]=d=>o.updateShow=!1),vacation:this.vacationToBeUpdated,toggle:this.toggleVacationRule,units:this.units,vacId:this.vacId},null,8,["vacation","toggle","units","vacId"])):v("",!0)])])}const Tt=T(rt,[["render",Dt]]);export{Tt as default};
