import{V as v}from"./ViewRulesModal-c52cd747.js";import{_,r as E,o as n,c as r,a as t,b as d,i as w,F as m,f,n as p,h as u,v as g,t as h,g as D}from"./index-8da96a42.js";const V={components:{ViewRulesModal:v},data(){return{searchFlag:null,showEmployees:!1,showVacations:!1,showRulesModal:!1,vacations:[],errorMsg:"",selectedVacation:"",specificVacations:[],specificEmployees:[],fromDate:null,toDate:null,empId:null,fromErr:!1,toErr:!1,empErr:!1,vacErr:!1,isBasedOnHire:!1,rule:{numberOfTimes:null,duration:null,unitID:null,unitName:null,startDate:null,endDate:null},hire:[]}},created(){this.fetchAllVacations()},methods:{handleSearchRadio(o){console.log("click",o.target.value),this.errorMsg="",this.empErr=!1,this.toErr=!1,this.fromErr=!1,this.vacErr=!1,o.target.value=="employee"?this.searchFlag=!0:o.target.value=="vacation"&&(this.searchFlag=!1),this.showEmployees=!1,this.showVacations=!1},handleSearchByVacation(o){if(console.log("searching by vacation"),this.errorMsg="",this.vacErr=!1,this.selectedVacation==""){this.errorMsg="Please select a vacation.",this.vacErr=!0;return}this.showEmployees=!0,this.fetchEmployees(o)},async handleSearchByEmployee(){if(console.log("searching by employee"),this.errorMsg="",this.showVacations=!1,this.empErr=!1,this.fromErr=!1,this.toErr=!1,(this.empId===null||this.empId==="")&&(this.empErr=!0),(this.fromDate===null||this.fromDate==="")&&(this.fromErr=!0),(this.toDate===null||this.toDate==="")&&(this.toErr=!0),console.log(this.empId,this.fromDate,this.toDate),this.empErr||this.fromErr||this.toErr==!0){console.log("error cant proceed"),this.errorMsg="Please fill in all the fields.";return}else if(this.fromDate>this.toDate){this.fromErr=!0,this.toErr=!0,this.errorMsg="Start date must be smaller than end date.";return}await this.fetchVacations(),console.log(this.errorMsg),this.errorMsg!=""?this.showVacations=!1:this.showVacations=!0},handleViewRules(o){console.log("view was clicked with vacation id = ",o),this.showRulesModal=!0,console.log(this.vacations);for(var e=0;e<this.vacations.length;e++)this.vacations[e].vacationID===o&&(this.isBasedOnHire=this.vacations[e].isBasedOnHire);console.log(this.rule.unitID),this.isBasedOnHire==!0?this.fetchVacationHire(o):this.isBasedOnHire==!1&&this.fetchVacationRule(o)},async fetchUnit(){const o={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.$store.state.token}`}};try{const e=await fetch("http://localhost:5242/api/unit/"+this.rule.unitID,o);if(e.status===401){console.log("action unauthorized, navigate to unauthorized page"),this.$router.push("/401");return}const a=await e.json();this.rule.unitName=a.unitName,console.log(this.rule.unitName)}catch(e){console.log(e.message)}},async fetchAllVacations(){const o={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.$store.state.token}`}};try{const a=await(await fetch("http://localhost:5242/api/vacation",o)).json();console.log(a),this.vacations=a}catch(e){console.log(e.message)}},async fetchEmployees(o){const e={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.$store.state.token}`}};try{const a=await fetch("http://localhost:5242/api/search/"+o,e);if(a.status===401){console.log("action unauthorized, navigate to unauthorized page"),this.$router.push("/401");return}const i=await a.json();console.log(i),this.specificEmployees=i}catch(a){console.log(a.message)}},async fetchVacations(){var o=this.fromDate,e=this.toDate;const a={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.$store.state.token}`},body:JSON.stringify({StartDate:o,EndDate:e})};try{const i=await fetch("http://localhost:5242/api/search/"+this.empId,a);if(i.status===401){console.log("action unauthorized, navigate to unauthorized page"),this.$router.push("/401");return}const l=await i.json();console.log(l),l.message?this.errorMsg=l.message:this.specificVacations=l}catch(i){console.log(i)}},async fetchVacationRule(o){const e={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.$store.state.token}`}};try{const i=await(await fetch("http://localhost:5242/api/rule/"+o,e)).json();console.log(i),this.rule.numberOfTimes=i.numberOfTimes,this.rule.duration=i.duration,this.rule.unitID=i.unitID,this.rule.startDate=i.startDate,this.rule.endDate=i.endDate,console.log(this.rule)}catch(a){console.log(a.message)}this.rule.unitID!==null&&this.fetchUnit()},async fetchVacationHire(o){const e={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.$store.state.token}`}};try{const i=await(await fetch("http://localhost:5242/api/hire/"+o,e)).json();console.log(i),this.hire=i,console.log(this.hire)}catch(a){console.log(a.message)}}}},b={class:"reports-container"},k=t("h2",{class:"form-title"},"Search by",-1),I={class:"radio-group-search"},B={id:"search-radio"},M={class:""},S=t("label",null,"Employee",-1),T={class:""},R=t("label",null,"Vacation",-1),C={key:0,class:"select-vacation-container"},z=t("option",{value:"",disabled:""},"Select Vacation",-1),j=["value"],F={key:1},O={class:"employee-table"},A=t("tr",null,[t("th",null,"ID"),t("th",null,"Image"),t("th",null,"Name"),t("th",null,"Date Hired"),t("th",null,"Phone"),t("th",null,"Email"),t("th",null,"Salary"),t("th",null,"Vacation Perm"),t("th"),t("th")],-1),N=["src"],H={key:2,class:"employee-input"},$=t("label",null,"Employee ID:",-1),x=t("label",null,"From:",-1),G=t("label",null,"To:",-1),P={class:"err-msg-cont"},U={key:3},J={class:"vacation-table"},L=t("tr",null,[t("th",null,"Name"),t("th",null,"Description"),t("th",null,"Rules"),t("th")],-1),q={class:"view-btn-container"},K=["onClick"];function Q(o,e,a,i,l,c){const y=E("ViewRulesModal");return n(),r("div",b,[k,t("div",I,[t("fieldset",B,[t("div",M,[t("input",{type:"radio",name:"search-group",value:"employee",onClick:e[0]||(e[0]=s=>c.handleSearchRadio(s))}),S]),t("div",T,[t("input",{type:"radio",name:"search-group",value:"vacation",onClick:e[1]||(e[1]=s=>c.handleSearchRadio(s))}),R])])]),this.searchFlag==!1?(n(),r("div",C,[d(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>l.selectedVacation=s),class:p(l.vacErr?"errField":"")},[z,(n(!0),r(m,null,f(this.vacations,s=>(n(),r("option",{key:s.vacationID,value:s.vacationID},h(s.name),9,j))),128))],2),[[w,l.selectedVacation]]),t("button",{type:"button",onClick:e[3]||(e[3]=s=>c.handleSearchByVacation(this.selectedVacation))},"Search")])):u("",!0),this.showEmployees==!0?(n(),r("div",F,[t("table",O,[A,(n(!0),r(m,null,f(l.specificEmployees,s=>(n(),r("tr",{key:s.EmployeeID},[t("td",null,h(s.employeeID),1),t("td",null,[t("img",{class:"user-pic2",src:`data:image/png;base64,${s.image}`},null,8,N)]),t("td",null,h(s.name),1),t("td",null,h(s.hiredDate.split("T")[0]),1),t("td",null,h(s.phone),1),t("td",null,h(s.email),1),t("td",null,h(s.salary)+".00 EGP",1),t("td",null,h(s.isVacationAllowed==!0?"Allowed":"Not allowed"),1)]))),128))])])):u("",!0),this.searchFlag==!0?(n(),r("div",H,[$,d(t("input",{type:"text",placeholder:"ID","onUpdate:modelValue":e[4]||(e[4]=s=>this.empId=s),id:"empIdInput",class:p(this.empErr?"errField":"")},null,2),[[g,this.empId]]),x,d(t("input",{type:"date","onUpdate:modelValue":e[5]||(e[5]=s=>this.fromDate=s),class:p(this.fromErr?"errField":"")},null,2),[[g,this.fromDate]]),G,d(t("input",{type:"date","onUpdate:modelValue":e[6]||(e[6]=s=>this.toDate=s),class:p(this.toErr?"errField":"")},null,2),[[g,this.toDate]]),t("button",{type:"button",onClick:e[7]||(e[7]=(...s)=>c.handleSearchByEmployee&&c.handleSearchByEmployee(...s))},"Search")])):u("",!0),t("div",P,[t("h3",null,h(this.errorMsg),1)]),this.showVacations==!0?(n(),r("div",U,[t("table",J,[L,(n(!0),r(m,null,f(l.specificVacations,s=>(n(),r("tr",{key:s.vacationID},[t("td",null,h(s.name),1),t("td",null,h(s.description),1),t("td",null,[t("div",q,[t("button",{class:"view-btn",onClick:W=>c.handleViewRules(s.vacationID)}," View ",8,K)])])]))),128))])])):u("",!0),this.showRulesModal==!0?(n(),D(y,{key:4,rule:l.rule,hire:l.hire,flag:l.isBasedOnHire,onCloseModal:e[8]||(e[8]=s=>this.showRulesModal=!1)},null,8,["rule","hire","flag"])):u("",!0)])}const Z=_(V,[["render",Q]]);export{Z as default};
